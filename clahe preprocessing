from google.colab import drive
drive.mount('/content/drive')

import cv2
import os
from glob import glob
from tqdm import tqdm

def clahe_and_save(input_dir, output_dir):
    os.makedirs(output_dir, exist_ok=True)

    for label in ['NORMAL', 'PNEUMONIA']:
        input_class_dir = os.path.join(input_dir, label)
        output_class_dir = os.path.join(output_dir, label)
        os.makedirs(output_class_dir, exist_ok=True)


        image_paths = []
        for ext in ['*.jpg', '*.jpeg', '*.png']:
            image_paths.extend(glob(os.path.join(input_class_dir, ext)))

        print(f"[{label}] Found {len(image_paths)} images in {input_class_dir}")
        print(f"Processing {label}:")

        for img_path in tqdm(image_paths):
            img = cv2.imread(img_path, cv2.IMREAD_GRAYSCALE)
            if img is None:
                continue

            img = cv2.resize(img, (224, 224))
            clahe = cv2.createCLAHE(clipLimit=2.0, tileGridSize=(8, 8))
            img_clahe = clahe.apply(img)
            img_rgb = cv2.cvtColor(img_clahe, cv2.COLOR_GRAY2RGB)

            filename = os.path.basename(img_path)
            cv2.imwrite(os.path.join(output_class_dir, filename), img_rgb)


clahe_and_save('/content/drive/My Drive/PneumoniaDataset3/chest_xray_new/train',
               '/content/clahe_dataset/train')

clahe_and_save('/content/drive/My Drive/PneumoniaDataset3/chest_xray_new/test',
               '/content/clahe_dataset/test')
